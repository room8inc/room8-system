# Room8 LINE連携

## 🎯 基本方針

**通常ログイン（メイン） + LINE連携（オプション）**

- **メイン**: メール+パスワードでログイン（ブックマークに保存しておく）
- **オプション**: LINE連携（Phase 2で追加、なくても使える）

---

## 📋 LINE連携の選択肢

### 選択肢1: LINEログイン（OAuth） + 自動ログイン

**方法：**
- LINEアカウントでログイン（LINEログイン機能）
- LINEアカウントと会員情報を紐付け
- LINEアプリ内で開く or LINEのDeep Linkから開く
- LINEアカウント情報で自動ログイン（毎回自動）

**メリット：**
- ✅ 毎回自動ログイン（面倒なログイン不要）
- ✅ LINEアカウントがあればすぐに使える
- ✅ パスワード管理不要
- ✅ 実装が比較的簡単（LINEログインSDK）

**デメリット：**
- ❌ LINEアカウントが必要
- ❌ LINE依存になる
- ❌ LINEアカウントがない人は使えない（別の方法も必要）

**必要なもの：**
- LINEログインSDK
- LINE Developersアカウント（無料）
- 追加コスト：ほぼなし（LINEログインは無料）

---

### 選択肢2: LINE公式アカウント + 自動ログイン + サイト誘導

**方法：**
- Room8のLINE公式アカウントを友だち追加
- LINE公式アカウント内で「チェックイン」ボタンを設置
- ボタンをタップするとサイトへ誘導
- LINEアカウント情報で自動ログイン
- **ブックマーク不要！LINEアプリから直接アクセス**

**メリット：**
- ✅ **LINEアプリから直接アクセス（ブックマーク不要）**
- ✅ **サイトへの誘導が簡単**（LINE公式アカウントから「チェックイン」ボタンをタップ）
- ✅ LINE公式アカウント内で完結
- ✅ 毎回自動ログイン
- ✅ 通知もLINE経由で送れる
- ✅ **ユーザーがURLを覚える必要がない**

**デメリット：**
- ❌ LINE公式アカウントの運用が必要
- ❌ 実装がやや複雑（Messaging API対応）
- ⚠️ LINE公式アカウントの料金（無料プラン or 有料プラン）

**必要なもの：**
- LINE Messaging API
- LINE公式アカウント

---

### 選択肢3: LINEログイン + LINE公式アカウント誘導 + 通常ログインの併用（推奨）

**方法：**
- LINEログイン（推奨・メイン）
- LINE公式アカウントからサイトへ誘導（ブックマーク不要）
- 通常のメール+パスワードログイン（フォールバック）
- LINEでログインした場合、自動ログイン維持

**メリット：**
- ✅ **LINEアプリから直接アクセス（ブックマーク不要）**
- ✅ **LINE公式アカウントからサイトへ誘導が簡単**
- ✅ LINEユーザーには最適（自動ログイン）
- ✅ LINEアカウントがない人にも対応
- ✅ 両方の方法を選べる
- ✅ **ユーザーがURLを覚える必要がない**

**デメリット：**
- ❌ 実装がやや複雑（2種類のログイン方法 + LINE公式アカウント運用）
- ⚠️ LINE公式アカウントの料金（無料プラン or 有料プラン）

---

## 💰 LINE公式アカウントの料金詳細

### 料金プラン

#### 1. コミュニケーションプラン（無料）⭐ **推奨**

**料金：**
- **月額**: 0円（無料）
- **月間メッセージ配信数**: 200通まで

**月間メッセージ配信数のカウント対象：**
- ✅ **一斉配信**（ブロードキャスト）：友だち数 × 配信回数でカウント
  - 例：100人の友だちに1回配信 = 100通カウント
- ✅ **プッシュ通知**（個別通知）：送信した通知数でカウント
  - 例：30人に個別通知 = 30通カウント
- ✅ **リプライ**（自動応答など）：ユーザーからのメッセージへの返信でカウント
  - 例：10人のユーザーに自動応答 = 10通カウント
- ✅ **個別メッセージ**（お客さんへの連絡事項など）：送信したメッセージ数でカウント
  - 例：お客さんに連絡事項を個別に送る = 送信数分カウント
  - 例：1人に1通送る = 1通カウント
- ❌ **ボタンタップ**：カウントされない（サイトへ誘導するだけ）

**Room8での用途：**
- 「チェックイン」ボタンを設置
- ボタンタップでサイトへ誘導（**メッセージ配信数にカウントされない**）
- LINEログイン機能を利用
- **ボタンでサイトへ誘導するだけなら配信数は0通** ✅ **無料でOK**

**月200通までの利用例：**
- **ボタンでサイトへ誘導するだけ**: 0通 ✅ **無料でOK**
- **個別メッセージ（お客さんへの連絡事項）**: 1人に1通送る = 1通カウント
  - 例：月100人のお客さんに連絡事項を送る = 100通カウント ✅ **無料プラン内**
  - 例：月200人に送る = 200通カウント ✅ **無料プランの上限ギリギリ**
- **チェックイン時に通知を送る場合**: 1日30人 × 30日 = 月900通 ❌ 超える可能性
- **推奨**: 通知はメール経由に変更すれば、LINE公式アカウントのメッセージ配信数は0通

---

#### 2. ライトプラン

**料金：**
- **月額**: 5,000円（税別）= 5,500円（税込み）
- **月間メッセージ配信数**: 5,000通まで

**特徴：**
- 月200通を超える場合に検討
- 月5,000通まで配信可能

---

#### 3. スタンダードプラン

**料金：**
- **月額**: 15,000円（税別）= 16,500円（税込み）
- **月間メッセージ配信数**: 30,000通まで
- **超過分**: 従量課金（1通あたり最大3円）

---

## 💡 個別メッセージの料金

### 結論

**個別メッセージ（お客さんへの連絡事項など）もカウントされますが、無料プランでも月200通まで送れます。**

- ✅ **無料プラン（月200通まで）**: 個別メッセージも無料で送信可能
- ⚠️ **200通を超える場合**: 追加メッセージは送信できない（有料プランにアップグレードが必要）
- **有料プラン（ライト）**: 月5,000通まで（月額5,500円）
- **有料プラン（スタンダード）**: 月30,000通まで（月額16,500円）、超過分は従量課金（1通あたり最大3円）

### Room8での想定利用状況

**想定利用者数：**
- **1日のチェックイン数**: 20〜30人
- **月間の利用者数**: 約100〜150人程度（重複あり）

**個別メッセージの利用例：**
- **ケース1：月に1回、全員に連絡事項を送る**
  - 100人のお客さんに連絡事項を送る = 100通カウント ✅ **無料プラン内**

- **ケース2：月に2回、全員に連絡事項を送る**
  - 100人のお客さん × 2回 = 200通カウント ✅ **無料プランの上限**

- **ケース3：頻繁に連絡事項を送る**
  - 100人のお客さん × 3回 = 300通カウント ❌ **無料プランを超える**
  - → ライトプラン（月額5,500円）にアップグレードが必要

---

## 📊 LINEログインの仕組み（簡単に）

### 基本的な仕組み

1. **初回ログイン**
   ```
   ユーザーが「LINEでログイン」ボタンをクリック
     ↓
   LINEアプリ or LINEログイン画面が開く
     ↓
   ユーザーがLINEアカウントで認証
     ↓
   アプリにLINEアカウント情報（ユーザーID、名前など）が返される
     ↓
   サーバー側で会員情報と紐付け（または新規登録）
     ↓
   セッション作成（30日間保持）
     ↓
   ログイン完了
   ```

2. **次回以降**
   ```
   LINEアプリ内でアプリを開く
     ↓
   LINEアカウント情報が自動で取得される
     ↓
   自動ログイン（セッション確認）
     ↓
   チェックイン画面表示
   ```

### LINEから開く方法

**方法A：LINEアプリ内ブラウザで開く**
- LINEアプリ内でWebアプリを開く
- LINEアカウント情報が自動で取得される

**方法B：Deep Linkから開く**
- LINE公式アカウントから「チェックイン」ボタンをタップ
- 外部アプリ（ブラウザ or ネイティブアプリ）を開く
- LINEアカウント情報で自動ログイン

---

## ✅ 決定事項

### 採用方針：通常ログイン（メイン） + LINE連携（オプション・Phase 2）

**Phase 1（MVP）:**
- ✅ メール+パスワードでログイン（メイン）
- ✅ セッションを30日間保持
- ✅ ブックマーク対応（標準機能）
- ✅ ID・パスワードを手入力でOK

**Phase 2（拡張・オプション）:**
- ⏳ LINEログイン機能を追加
- ⏳ LINE公式アカウントを開設・運用（**無料プランでOK**）
- ⏳ LINE公式アカウント内に「チェックイン」ボタンを設置
- ⏳ ボタンタップでサイトへ誘導（Deep Link）
- ⏳ LINEアプリから開いた場合、自動ログイン

**コスト：**
- 基本機能：無料
- LINEログイン：無料（Phase 2）
- **LINE公式アカウント：無料プランでOK（Phase 2）**
  - **コミュニケーションプラン（無料）**: 月額0円、月200通まで
  - **ボタンでサイトへ誘導するだけなら、メッセージ配信数は0通** ✅ **無料でOK**
  - 個別メッセージ（お客さんへの連絡事項）: **月200通まで無料**
  - 一斉配信やプッシュ通知が多い場合のみ有料プラン（月額5,500円〜）

**成長戦略：**
- ✅ **まずは無料プランで十分**
- ✅ **そのうち会員数が増えて活発になってきたら有料プランにアップグレード**

---

## 🎯 まとめ

### LINE連携の基本方針

- ✅ **基本は通常ログイン**（メール+パスワード）
- ✅ **LINE連携はオプション**（Phase 2で追加）
- ✅ **LINE公式アカウントは無料プランでOK**（ボタンでサイトへ誘導するだけなら月額0円）
- ✅ **個別メッセージも月200通まで無料**

### ユーザー体験

**基本パターン（メイン）：**
- ブックマーク + 手入力でログイン
- セッション30日間保持

**LINEパターン（オプション・Phase 2）：**
- LINE公式アカウントから「チェックイン」ボタンをタップ
- 自動ログイン
- チェックイン画面表示

