# Supabaseデータベースセットアップガイド

## 🎯 目標

Supabaseでデータベーステーブルを作成し、初期データを投入する。

---

## 📋 手順

### ステップ1: Supabaseダッシュボードを開く

1. **Supabaseダッシュボード**にアクセス
   - https://supabase.com にアクセス
   - ログインする

2. **プロジェクトを選択**
   - Room8のSupabaseプロジェクトを選択

### ステップ2: SQL Editorを開く

1. 左メニューから **「SQL Editor」** をクリック
2. **「New query」** をクリック（新しいクエリを作成）

### ステップ3: テーブルを作成（マイグレーション実行）

#### 3-1. 初期スキーマを作成

1. **SQL Editor**で、以下のファイルの内容をコピー：
   - `supabase/migrations/001_initial_schema.sql`

2. **SQL Editor**に貼り付け

3. **「Run」** ボタンをクリック（または `Cmd+Enter` / `Ctrl+Enter`）

4. **実行結果を確認**
   - 「Success. No rows returned」と表示されれば成功
   - エラーが出た場合は、エラーメッセージを確認

#### 3-2. プランの初期データを投入

1. **新しいクエリを作成**（「New query」をクリック）

2. 以下のファイルの内容をコピー：
   - `supabase/migrations/002_seed_plans.sql`

3. **SQL Editor**に貼り付け

4. **「Run」** ボタンをクリック

5. **実行結果を確認**
   - 「Success. No rows returned」と表示されれば成功

### ステップ4: テーブルを確認

1. 左メニューから **「Table Editor」** をクリック

2. **作成されたテーブルを確認**
   - `users`
   - `plans`
   - `user_plans`
   - `checkins`
   - `lockers`

3. **`plans`テーブルを開く**
   - 9プランのデータが投入されているか確認

---

## ✅ 確認チェックリスト

### テーブル作成
- [ ] `users`テーブルが作成されている ✅
- [ ] `plans`テーブルが作成されている ✅
- [ ] `user_plans`テーブルが作成されている ✅
- [ ] `checkins`テーブルが作成されている ✅
- [ ] `lockers`テーブルが作成されている ✅

### 初期データ投入
- [ ] `plans`テーブルに9プランのデータが投入されている ✅
  - [ ] 起業家プラン
  - [ ] レギュラープラン
  - [ ] ライトプラン
  - [ ] フルタイムプラン
  - [ ] ウィークデイプラン
  - [ ] デイタイムプラン
  - [ ] ナイト&ホリデープラン
  - [ ] ナイトプラン
  - [ ] ホリデープラン

### インデックス・制約
- [ ] 各テーブルにインデックスが設定されている ✅
- [ ] 外部キー制約が設定されている ✅
- [ ] `updated_at`の自動更新トリガーが設定されている ✅

---

## 🔍 トラブルシューティング

### エラーが出る場合

#### エラー: "relation already exists"
- 原因: 既にテーブルが存在している
- 解決方法: 
  - Table Editorで既存のテーブルを確認
  - 必要に応じて削除してから再実行

#### エラー: "permission denied"
- 原因: 権限が不足している
- 解決方法:
  - プロジェクトのオーナー権限を確認
  - SQL Editorの実行権限を確認

#### エラー: "syntax error"
- 原因: SQLの構文エラー
- 解決方法:
  - エラーメッセージを確認
  - SQLファイルを再度確認

---

## 📝 次のステップ

データベースのセットアップが完了したら：

1. **Supabase接続テスト**（Next.jsから）
2. **認証機能の実装開始**（Phase 1-2）

---

**SQL Editorでマイグレーションファイルを実行してください！**

