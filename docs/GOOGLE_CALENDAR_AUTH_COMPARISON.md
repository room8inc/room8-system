# Googleカレンダー連携 - Service Account vs OAuth認証フロー

## 2つの認証方式の違い

### 1. Service Account方式（現在の実装）

**特徴:**
- ✅ **サーバー間の認証**（ブラウザでのログイン不要）
- ✅ **1つの共通カレンダー**を管理
- ✅ **ユーザーごとに異なるカレンダー**ではなく、**Room8の会議室カレンダー**を共有
- ✅ **自動的に動作**（ユーザーの操作不要）

**用途:**
- 会議室予約システム（Room8の会議室カレンダー）
- システムが自動的に予約を追加・削除
- 全てのユーザーが同じカレンダーを見る

**設定方法:**
1. Google Cloud ConsoleでService Accountを作成
2. Service Accountのメールアドレスをカレンダーに共有（編集権限）
3. JSONキーをダウンロードして環境変数に設定
4. 管理者が管理画面でカレンダーを選択

**イメージ:**
```
Room8システム → Service Account → Room8会議室カレンダー
（全ユーザーが共有する1つのカレンダー）
```

---

### 2. OAuth認証フロー（ブラウザでログイン）

**特徴:**
- ✅ **ユーザーごとに異なるカレンダー**にアクセス
- ✅ **ユーザーが自分でGoogleアカウントでログイン**
- ✅ **アクセストークン**を取得（有効期限あり）
- ⚠️ **ユーザーごとに異なるカレンダー**を管理

**用途:**
- 個人のGoogleカレンダーと連携
- ユーザーが自分のカレンダーに予約を追加したい場合
- ユーザーごとに異なるカレンダーを見る

**設定方法:**
1. Google Cloud ConsoleでOAuth 2.0クライアントIDを作成
2. ユーザーがブラウザでGoogleアカウントでログイン
3. アクセストークンを取得
4. ユーザーごとに異なるカレンダーにアクセス

**イメージ:**
```
ユーザーA → OAuth認証 → ユーザーAのGoogleカレンダー
ユーザーB → OAuth認証 → ユーザーBのGoogleカレンダー
（ユーザーごとに異なるカレンダー）
```

---

## Room8の会議室予約システムの場合

### Service Account方式が適している理由

**会議室予約システムの要件:**
- ✅ **1つの共通カレンダー**（Room8の会議室カレンダー）を管理
- ✅ **全ユーザーが同じカレンダー**を見る
- ✅ **システムが自動的に予約を追加・削除**（ユーザーの操作不要）
- ✅ **ダブルブッキング防止**（全ユーザーが同じカレンダーを参照）

**Service Account方式のメリット:**
- ✅ ユーザーがGoogleアカウントを持っていなくても動作
- ✅ ユーザーがログインする必要がない
- ✅ 1つのカレンダーで全予約を管理（シンプル）
- ✅ アクセストークンの有効期限を気にしないでよい

**OAuth方式のデメリット:**
- ❌ ユーザーごとに異なるカレンダーになってしまう
- ❌ ユーザーがGoogleアカウントを持っている必要がある
- ❌ アクセストークンの有効期限管理が必要
- ❌ ユーザーごとに異なるカレンダーを見るため、ダブルブッキング防止が複雑

---

## もしOAuth方式を使いたい場合

**ユースケース例:**
- ユーザーが自分のGoogleカレンダーにも予約を追加したい
- ユーザーごとに異なるカレンダーを使いたい

**実装方法:**
1. Google Cloud ConsoleでOAuth 2.0クライアントIDを作成
2. `googleapis`の`google.auth.OAuth2Client`を使用
3. ユーザーがブラウザでGoogleアカウントでログイン
4. アクセストークンを取得・保存
5. ユーザーごとに異なるカレンダーにアクセス

**ただし、Room8の会議室予約システムでは、Service Account方式が推奨されます。**

---

## まとめ

| 項目 | Service Account方式 | OAuth認証フロー |
|------|---------------------|-----------------|
| **認証方法** | サーバー間認証 | ユーザーがブラウザでログイン |
| **カレンダー** | 1つの共通カレンダー | ユーザーごとに異なるカレンダー |
| **設定の複雑さ** | 中（Service Account設定） | 高（OAuth設定 + トークン管理） |
| **ユーザー操作** | 不要 | 必要（ログイン） |
| **Room8の用途** | ✅ **適している** | ❌ 不適切 |

**結論: Room8の会議室予約システムでは、Service Account方式が最適です。**

