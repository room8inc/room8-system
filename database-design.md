# Room8 ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆæ›¸

## ğŸ¯ ç›®æ¨™

ã‚·ã‚¹ãƒ†ãƒ ã®åŸºç›¤ã¨ãªã‚‹ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ§‹é€ ã‚’è¨­è¨ˆãƒ»å®Ÿè£…ã™ã‚‹ã€‚

---

## ğŸ“‹ å¿…è¦ãªãƒ†ãƒ¼ãƒ–ãƒ«ä¸€è¦§

### åŸºæœ¬ãƒ†ãƒ¼ãƒ–ãƒ«

1. **usersï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼/ä¼šå“¡ãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰**
   - ä¼šå“¡ã®åŸºæœ¬æƒ…å ±ã‚’ç®¡ç†

2. **plansï¼ˆãƒ—ãƒ©ãƒ³ãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰**
   - 9ã¤ã®å®šé¡ãƒ—ãƒ©ãƒ³æƒ…å ±ã‚’ç®¡ç†

3. **user_plansï¼ˆä¼šå“¡ãƒ—ãƒ©ãƒ³å±¥æ­´ãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰**
   - ä¼šå“¡ã®ãƒ—ãƒ©ãƒ³é¸æŠãƒ»å¤‰æ›´å±¥æ­´ã‚’ç®¡ç†

4. **checkinsï¼ˆãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³/ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆãƒ­ã‚°ãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰**
   - ãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³/ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆã®å±¥æ­´ã‚’ç®¡ç†

5. **lockersï¼ˆãƒ­ãƒƒã‚«ãƒ¼ãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰**
   - ãƒ­ãƒƒã‚«ãƒ¼ã®ç®¡ç†ï¼ˆæ‰‹å‹•ç®¡ç†ï¼‰

### å°†æ¥çš„ã«å¿…è¦ãªãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆPhase 2ä»¥é™ï¼‰

1. **meeting_roomsï¼ˆä¼šè­°å®¤ãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰**
2. **meeting_room_bookingsï¼ˆä¼šè­°å®¤äºˆç´„ãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰**
3. **meeting_room_usage_logsï¼ˆä¼šè­°å®¤åˆ©ç”¨ãƒ­ã‚°ãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰**
4. **paymentsï¼ˆæ±ºæ¸ˆãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰**
5. **billing_itemsï¼ˆè«‹æ±‚é …ç›®ãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰**

---

## ğŸ“Š ãƒ†ãƒ¼ãƒ–ãƒ«è¨­è¨ˆï¼ˆè©³ç´°ï¼‰

### 1. usersï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼/ä¼šå“¡ãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰

**ç›®çš„**: ä¼šå“¡ã®åŸºæœ¬æƒ…å ±ã‚’ç®¡ç†

| ã‚«ãƒ©ãƒ å | å‹ | åˆ¶ç´„ | èª¬æ˜ |
|---------|-----|------|------|
| id | uuid | PRIMARY KEY | ãƒ¦ãƒ¼ã‚¶ãƒ¼IDï¼ˆSupabase Authã‹ã‚‰å–å¾—ï¼‰ |
| email | text | UNIQUE, NOT NULL | ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ |
| name | text | NOT NULL | æ°å |
| name_kana | text | | æ°åï¼ˆã‚«ãƒŠï¼‰ |
| phone | text | | é›»è©±ç•ªå· |
| address | text | | ä½æ‰€ |
| member_type | text | NOT NULL | ä¼šå“¡ç¨®åˆ¥ï¼ˆ'regular', 'dropin', 'guest'ï¼‰ |
| is_individual | boolean | NOT NULL | å€‹äººä¼šå“¡ã‹æ³•äººä¼šå“¡ã‹ï¼ˆtrue: å€‹äºº, false: æ³•äººï¼‰ |
| company_name | text | | ä¼šç¤¾åï¼ˆæ³•äººã®å ´åˆï¼‰ |
| id_document_url | text | | èº«åˆ†è¨¼æ˜æ›¸ã®URLï¼ˆSupabase Storageï¼‰ |
| company_registry_url | text | | ç™»è¨˜ç°¿è¬„æœ¬ã®URLï¼ˆæ³•äººã®å ´åˆã€Supabase Storageï¼‰ |
| status | text | NOT NULL | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ï¼ˆ'active', 'inactive', 'cancelled'ï¼‰ |
| created_at | timestamp | NOT NULL | ç™»éŒ²æ—¥æ™‚ |
| updated_at | timestamp | NOT NULL | æ›´æ–°æ—¥æ™‚ |

**ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹**:

- `email` (UNIQUE)
- `member_type`
- `status`

---

### 2. plansï¼ˆãƒ—ãƒ©ãƒ³ãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰

**ç›®çš„**: å®šé¡ãƒ—ãƒ©ãƒ³ã®æƒ…å ±ã‚’ç®¡ç†

| ã‚«ãƒ©ãƒ å | å‹ | åˆ¶ç´„ | èª¬æ˜ |
|---------|-----|------|------|
| id | uuid | PRIMARY KEY | ãƒ—ãƒ©ãƒ³ID |
| name | text | NOT NULL | ãƒ—ãƒ©ãƒ³åï¼ˆä¾‹: "ãƒ‡ã‚¤ã‚¿ã‚¤ãƒ ãƒ—ãƒ©ãƒ³"ï¼‰ |
| code | text | UNIQUE, NOT NULL | ãƒ—ãƒ©ãƒ³ã‚³ãƒ¼ãƒ‰ï¼ˆä¾‹: "daytime"ï¼‰ |
| price | integer | NOT NULL | æœˆé¡æ–™é‡‘ï¼ˆå††ï¼‰ |
| available_days | text[] | NOT NULL | åˆ©ç”¨å¯èƒ½æ›œæ—¥ï¼ˆä¾‹: ['monday', 'tuesday', ...]ï¼‰ |
| start_time | time | NOT NULL | åˆ©ç”¨é–‹å§‹æ™‚åˆ»ï¼ˆä¾‹: '09:00'ï¼‰ |
| end_time | time | NOT NULL | åˆ©ç”¨çµ‚äº†æ™‚åˆ»ï¼ˆä¾‹: '17:00'ï¼‰ |
| features | jsonb | | ãƒ—ãƒ©ãƒ³ã®ç‰¹å¾´ãƒ»ã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼ˆJSONå½¢å¼ï¼‰ |
| is_active | boolean | NOT NULL | æœ‰åŠ¹ã‹ã©ã†ã‹ |
| display_order | integer | | è¡¨ç¤ºé †åº |
| created_at | timestamp | NOT NULL | ä½œæˆæ—¥æ™‚ |
| updated_at | timestamp | NOT NULL | æ›´æ–°æ—¥æ™‚ |

**ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹**:

- `code` (UNIQUE)
- `is_active`

**åˆæœŸãƒ‡ãƒ¼ã‚¿**: 9ãƒ—ãƒ©ãƒ³ã®æƒ…å ±ã‚’æŠ•å…¥

---

### 3. user_plansï¼ˆä¼šå“¡ãƒ—ãƒ©ãƒ³å±¥æ­´ãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰

**ç›®çš„**: ä¼šå“¡ã®ãƒ—ãƒ©ãƒ³é¸æŠãƒ»å¤‰æ›´å±¥æ­´ã‚’ç®¡ç†

| ã‚«ãƒ©ãƒ å | å‹ | åˆ¶ç´„ | èª¬æ˜ |
|---------|-----|------|------|
| id | uuid | PRIMARY KEY | ãƒ¬ã‚³ãƒ¼ãƒ‰ID |
| user_id | uuid | NOT NULL, FK(users.id) | ãƒ¦ãƒ¼ã‚¶ãƒ¼ID |
| plan_id | uuid | NOT NULL, FK(plans.id) | ãƒ—ãƒ©ãƒ³ID |
| started_at | date | NOT NULL | ãƒ—ãƒ©ãƒ³é–‹å§‹æ—¥ |
| ended_at | date | | ãƒ—ãƒ©ãƒ³çµ‚äº†æ—¥ï¼ˆnull: ç¾åœ¨ã®ãƒ—ãƒ©ãƒ³ï¼‰ |
| status | text | NOT NULL | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ï¼ˆ'active', 'cancelled', 'changed'ï¼‰ |
| created_at | timestamp | NOT NULL | ä½œæˆæ—¥æ™‚ |
| updated_at | timestamp | NOT NULL | æ›´æ–°æ—¥æ™‚ |

**ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹**:

- `user_id`
- `plan_id`
- `status`
- `(user_id, status)` - ç¾åœ¨ã®ãƒ—ãƒ©ãƒ³ã‚’ç´ æ—©ãå–å¾—

---

### 4. checkinsï¼ˆãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³/ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆãƒ­ã‚°ãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰

**ç›®çš„**: ãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³/ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆã®å±¥æ­´ã‚’ç®¡ç†

| ã‚«ãƒ©ãƒ å | å‹ | åˆ¶ç´„ | èª¬æ˜ |
|---------|-----|------|------|
| id | uuid | PRIMARY KEY | ãƒ­ã‚°ID |
| user_id | uuid | NOT NULL, FK(users.id) | ãƒ¦ãƒ¼ã‚¶ãƒ¼ID |
| checkin_at | timestamp | NOT NULL | ãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³æ™‚åˆ» |
| checkout_at | timestamp | | ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆæ™‚åˆ»ï¼ˆnull: ã¾ã é€€å®¤ã—ã¦ã„ãªã„ï¼‰ |
| duration_minutes | integer | | æ»åœ¨æ™‚é–“ï¼ˆåˆ†ï¼‰ |
| member_type_at_checkin | text | NOT NULL | ãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³æ™‚ã®ä¼šå“¡ç¨®åˆ¥ï¼ˆ'regular', 'dropin', 'guest'ï¼‰ |
| plan_id_at_checkin | uuid | FK(plans.id) | ãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³æ™‚ã®ãƒ—ãƒ©ãƒ³IDï¼ˆå®šé¡ä¼šå“¡ã®å ´åˆï¼‰ |
| venue_id | text | NOT NULL | ä¼šå ´IDï¼ˆQRã‚³ãƒ¼ãƒ‰ã‹ã‚‰å–å¾—ï¼‰ |
| is_overtime | boolean | DEFAULT false | æ™‚é–“å¤–åˆ©ç”¨ã‹ã©ã†ã‹ |
| overtime_minutes | integer | | æ™‚é–“å¤–åˆ©ç”¨æ™‚é–“ï¼ˆåˆ†ï¼‰ |
| dropin_fee | integer | | ãƒ‰ãƒ­ãƒƒãƒ—ã‚¤ãƒ³æ–™é‡‘ï¼ˆå††ã€ãƒ‰ãƒ­ãƒƒãƒ—ã‚¤ãƒ³ä¼šå“¡ã®å ´åˆï¼‰ |
| created_at | timestamp | NOT NULL | ä½œæˆæ—¥æ™‚ |
| updated_at | timestamp | NOT NULL | æ›´æ–°æ—¥æ™‚ |

**ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹**:

- `user_id`
- `checkout_at`
- `(user_id, checkout_at)` - ç¾åœ¨ãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³ä¸­ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ç´ æ—©ãå–å¾—

---

### 5. lockersï¼ˆãƒ­ãƒƒã‚«ãƒ¼ãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰

**ç›®çš„**: ãƒ­ãƒƒã‚«ãƒ¼ã®ç®¡ç†ï¼ˆç®¡ç†è€…ãŒæ‰‹å‹•ã§ç®¡ç†ï¼‰

| ã‚«ãƒ©ãƒ å | å‹ | åˆ¶ç´„ | èª¬æ˜ |
|---------|-----|------|------|
| id | uuid | PRIMARY KEY | ãƒ­ãƒƒã‚«ãƒ¼ID |
| locker_number | text | UNIQUE, NOT NULL | ãƒ­ãƒƒã‚«ãƒ¼ç•ªå·ï¼ˆä¾‹: "001", "002"ï¼‰ |
| user_id | uuid | FK(users.id) | åˆ©ç”¨ä¸­ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼IDï¼ˆnull: ç©ºãï¼‰ |
| status | text | NOT NULL | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ï¼ˆ'available', 'occupied', 'maintenance'ï¼‰ |
| notes | text | | ãƒ¡ãƒ¢ï¼ˆç®¡ç†è€…ç”¨ï¼‰ |
| created_at | timestamp | NOT NULL | ä½œæˆæ—¥æ™‚ |
| updated_at | timestamp | NOT NULL | æ›´æ–°æ—¥æ™‚ |

**ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹**:

- `locker_number` (UNIQUE)
- `user_id`
- `status`

---

### 6. user_plans è¿½åŠ ã‚«ãƒ©ãƒ ï¼ˆãƒ¡ãƒ³ãƒãƒ¼æ‹›å¾…æ©Ÿèƒ½ï¼‰

**ç›®çš„**: ãƒ¡ã‚¤ãƒ³ä¼šå“¡ãŒãƒ¡ãƒ³ãƒãƒ¼ã‚’æ‹›å¾…ã—ã€50% OFFã§åˆ©ç”¨å¯èƒ½ã«ã™ã‚‹

| ã‚«ãƒ©ãƒ å | å‹ | åˆ¶ç´„ | èª¬æ˜ |
|---------|-----|------|------|
| invited_by | uuid | FK(users.id) | æ‹›å¾…å…ƒãƒ¦ãƒ¼ã‚¶ãƒ¼IDï¼ˆNULL=é€šå¸¸ã®å€‹äººå¥‘ç´„ã€NOT NULL=æ‹›å¾…ã•ã‚ŒãŸãƒ¡ãƒ³ãƒãƒ¼ï¼‰ |
| discount_code | text | | é©ç”¨ã•ã‚ŒãŸå‰²å¼•ã‚³ãƒ¼ãƒ‰ï¼ˆä¾‹: 'group_50off'ï¼‰ |

**ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹**:
- `invited_by` (WHERE invited_by IS NOT NULL)

**RLSãƒãƒªã‚·ãƒ¼**:
- ãƒ›ã‚¹ãƒˆã¯è‡ªåˆ†ãŒæ‹›å¾…ã—ãŸãƒ¡ãƒ³ãƒãƒ¼ã®ãƒ—ãƒ©ãƒ³ã‚’SELECTã§ãã‚‹ï¼ˆ`auth.uid() = invited_by`ï¼‰
- INSERT/UPDATEã¯service clientçµŒç”±ï¼ˆãƒ›ã‚¹ãƒˆãŒåˆ¥ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’æ“ä½œã™ã‚‹ãŸã‚ï¼‰

**ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«ä¾‹**:
```
ãƒ¡ã‚¤ãƒ³ä¼šå“¡ï¼ˆé¶´ç”°ï¼‰
  user_plans: { user_id: A, plan_id: fulltime, invited_by: NULL }

ãƒ¡ãƒ³ãƒãƒ¼1ï¼ˆèŠ±å­ï¼‰
  user_plans: { user_id: B, plan_id: daytime, invited_by: A, discount_code: 'group_50off' }
```

**Stripeé€£æº**: ãƒ¡ã‚¤ãƒ³ä¼šå“¡ã®ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³1æœ¬ã«ã€ãƒ¡ãƒ³ãƒãƒ¼åˆ†ã®ã‚¢ã‚¤ãƒ†ãƒ ã‚’è¿½åŠ ï¼ˆ50% OFFã‚¯ãƒ¼ãƒãƒ³ä»˜ãï¼‰

---

## ğŸ”— ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆERå›³ï¼‰

```text
users (1) â”€â”€â”€< (N) user_plans (N) >â”€â”€â”€ (1) plans
  â”‚                    â”‚
  â”‚ (1)                â”‚ invited_by
  â”‚                    â”‚
  â”‚                    â””â”€â”€> users (æ‹›å¾…å…ƒ)
  â”‚
  â””â”€â”€< (N) checkins
  â”‚
  â”‚ (1)
  â”‚
  â””â”€â”€< (N) lockers
```

---

## ğŸ“ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

### 1. Supabaseã§ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ

1. **Supabaseãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰**ã‚’é–‹ã
2. **Table Editor**ã‚’é–‹ã
3. å„ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ä½œæˆ
4. ã‚«ãƒ©ãƒ ã‚’å®šç¾©
5. ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’è¿½åŠ 
6. å¤–éƒ¨ã‚­ãƒ¼åˆ¶ç´„ã‚’è¨­å®š

### 2. åˆæœŸãƒ‡ãƒ¼ã‚¿æŠ•å…¥

- **plansãƒ†ãƒ¼ãƒ–ãƒ«**: 9ãƒ—ãƒ©ãƒ³ã®æƒ…å ±ã‚’æŠ•å…¥
- **lockersãƒ†ãƒ¼ãƒ–ãƒ«**: ãƒ­ãƒƒã‚«ãƒ¼ã®åˆæœŸãƒ‡ãƒ¼ã‚¿ã‚’æŠ•å…¥

### 3. ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ä½œæˆ

- é–‹ç™ºç”¨ã®ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ä½œæˆ
- ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã§å‹•ä½œç¢ºèª

---

## âœ… ç¢ºèªäº‹é …

### è¨­è¨ˆã®ç¢ºèªãƒã‚¤ãƒ³ãƒˆ

- [ ] å¿…è¦ãªæƒ…å ±ãŒã™ã¹ã¦ãƒ†ãƒ¼ãƒ–ãƒ«ã«å«ã¾ã‚Œã¦ã„ã‚‹
- [ ] ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãŒæ­£ã—ãå®šç¾©ã•ã‚Œã¦ã„ã‚‹
- [ ] ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãŒé©åˆ‡ã«è¨­å®šã•ã‚Œã¦ã„ã‚‹
- [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’è€ƒæ…®ã—ãŸè¨­è¨ˆã«ãªã£ã¦ã„ã‚‹

---

**ã“ã®è¨­è¨ˆæ›¸ã‚’åŸºã«ã€Supabaseã§ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ä½œæˆã—ã¦ã„ãã¾ã—ã‚‡ã†ï¼**
